{% extends 'main.html' %}
{% load static %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <h2 class="text-3xl font-bold text-center mb-8 pt-16">Checkout</h2>
  
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

      <!-- Checkout Form -->
      <div class="bg-white p-6 rounded-lg shadow-md">
        <h3 class="text-xl font-semibold mb-4">Customer & Shipping Details</h3>
        <form id="checkout-form" method="POST" action="{% url 'initiate-payment' %}">
          {% csrf_token %}
          
          <div class="mb-4">
            <label for="fullName" class="block text-sm font-medium text-gray-700">Full Name</label>
            <input type="text" id="fullName" name="fullName" placeholder="Enter your full name" 
                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-3"
                   value="{% if request.user.is_authenticated %}{{ request.user.get_full_name }}{% endif %}" required>
          </div>

          <div class="mb-4">
            <label for="email" class="block text-sm font-medium text-gray-700">Email Address</label>
            <input type="email" id="email" name="email" placeholder="Enter your email"
                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-3"
                   value="{% if request.user.is_authenticated %}{{ request.user.email }}{% endif %}" required>
          </div>

          <div class="mb-4">
            <label for="phone" class="block text-sm font-medium text-gray-700">Phone Number</label>
            <input type="text" id="phone" name="phone" placeholder="Enter your phone number"
                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-3"
                   value="{% if request.user.is_authenticated and request.user.customer.phone %}{{ request.user.customer.phone }}{% endif %}">
          </div>

          <div class="mb-4">
            <label for="address" class="block text-sm font-medium text-gray-700">Delivery Address</label>
            <input type="text" id="address" name="address" placeholder="Street address"
                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-3"
                   value="{% if request.user.is_authenticated and request.user.customer.address %}{{ request.user.customer.address }}{% endif %}" required>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label for="city" class="block text-sm font-medium text-gray-700">City</label>
              <input type="text" id="city" name="city" placeholder="City"
                     class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-3"
                     value="{% if request.user.is_authenticated and request.user.customer.city %}{{ request.user.customer.city }}{% endif %}" required>
            </div>
            <div>
              <label for="state" class="block text-sm font-medium text-gray-700">State</label>
              <input type="text" id="state" name="state" placeholder="State"
                     class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-3"
                     value="{% if request.user.is_authenticated and request.user.customer.state %}{{ request.user.customer.state }}{% endif %}" required>
            </div>
          </div>

          <div class="mb-4">
            <label for="zipcode" class="block text-sm font-medium text-gray-700">Zipcode</label>
            <input type="text" id="zipcode" name="zipcode" placeholder="Zipcode"
                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-3"
                   value="{% if request.user.is_authenticated and request.user.customer.zipcode %}{{ request.user.customer.zipcode }}{% endif %}" required>
          </div>

          <div class="text-right">
            <p class="text-lg font-semibold">Total: <span class="text-[#8B5E3C]">₦ {{ cart_total }}</span></p>
            <button type="submit" id="place-order-btn" class="mt-4 w-full bg-[#8B5E3C] text-white py-2 px-4 rounded-md hover:bg-[#6B4423] transition duration-300">
                Proceed to Payment
            </button>
        </div>
        </form>
      </div>

      <!-- Order Summary -->
      <div class="bg-white p-6 rounded-lg shadow-md">
        <h3 class="text-xl font-semibold mb-4">Order Items</h3>
        <div class="space-y-4">
          {% for item in cart_items %}
            <div class="flex items-center">
              {% if item.product.product_image %}
                <img src="{{ item.product.product_image.url }}" alt="{{ item.product.name }}" class="w-16 h-16 object-cover rounded-md mr-4">
              {% else %}
                <img src="{% static 'images/placeholder.png' %}" alt="{{ item.product.name }}" class="w-16 h-16 object-cover rounded-md mr-4">
              {% endif %}
              <div>
                <p class="font-medium">{{ item.product.name }}</p>
                <p class="text-gray-600">Quantity: {{ item.quantity }}</p>
                <p class="text-[#8B5E3C] font-semibold">₦{{ item.get_total }}</p> 
              </div>
            </div>
          {% empty %}
            <p class="text-gray-600">No items in your order.</p>
          {% endfor %}
        </div>
        <div class="mt-6 text-right">
          <p class="text-lg font-semibold">Total: <span class="text-[#8B5E3C]">₦{{ cart_total }}</span></p>
        </div>
      </div>

    </div>
</div>

<!-- <script>  

document.addEventListener('DOMContentLoaded', function(){
    const checkoutForm = document.getElementById('checkout-form');
    const placeOrderBtn = document.getElementById('place-order-btn');

    checkoutForm.addEventListener('submit', function(e){
        e.preventDefault();

        let userLoggedIn = '{{ request.user.is_authenticated }}';  // True or False
        if(userLoggedIn === 'False'){
            alert('You need to log in before checking out.');
            window.location.href = '{% url "register_page" %}';
            return;
        }

        // Continue with checkout process if logged in
        // Here you can submit form via AJAX or trigger payment integration
        alert('Form submitted! (Demo)');
    });
});
</script> -->


{% endblock %}
